"use strict";

function clearDate() {
    date = "", dateArray = [], secondNumber = [], matrix = [],
	console.log('MatrixCalculated');

}

function replaceDate() {
    date = $(".matrix__input").val();
    var e = date.split(".");
    e.forEach(function(e, t) {
        var r = e.split("");
        dateArray = dateArray.concat(r)
    })
}

function clearArray(e) {
    return 0 == e[0] && e.splice(0, 1), 0 == e[1] && e.splice(1, 1), 0 == e[2] && e.splice(2, 1), e
}

function secondNumbers() {
    secondNumber[0] = firstSecondNumber(), secondNumber[1] = secondSecondNumber(secondNumber[0]), secondNumber[2] = thirdSecondNumber(), secondNumber[3] = secondSecondNumber(secondNumber[2])
}

function firstSecondNumber() {
    var e = 0;
    return dateArray.forEach(function(t, r) {
        e += parseInt(t, 10)
    }), e
}

function secondSecondNumber(e) {
    var t = 0,
        r = e.toString().split("");
    return r.forEach(function(e, r) {
        t += parseInt(e, 10)
    }), t
}

function thirdSecondNumber() {
    var e = secondNumber[0],
        t = Math.abs(e - 2 * parseInt(dateArray[0], 10));
    return t
}

function toInteger() {
    var e = [];
    return fullNumbers.forEach(function(t, r) {
        var a = t.toString(),
            n = a.split("");
        n.forEach(function(t, r) {
            var a = parseInt(t, 10);
            e = e.concat(a)
        })
    }), e
}

function getMatrix() {
    for (var e = [], t = [], r = 1; r <= 9; r++) e[r - 1] = "", t[r - 1] = 0, fullNumbers.forEach(function(a, n) {
        a == r && (e[r - 1] += "" + r, t[r - 1]++)
    }), "" == e[r - 1] && (e[r - 1] = 0);
    return e[9] = t[2] + t[4] + t[6], e[10] = t[3] + t[4] + t[5], e[11] = t[1] + t[4] + t[7], e[12] = t[0] + t[3] + t[6], e[13] = t[2] + t[5] + t[8], e
}

function destinyNumber() {
    var e = 0;
    e = secondNumber[1] == 11 ? 11 : secondSecondNumber(secondNumber[1])
    return e
}

function getLoader() {
    $(".result").addClass("loader")
}

function deleteLoader() {
    setTimeout(function() {
        $(".result").addClass("loader-fade")
    }, 500), setTimeout(function() {
        $(".result").removeClass("loader loader-fade"), $(".result").addClass("show")
    }, 250)
}

function showMatrix() {
    var e = secondNumber.join();
    $(".result__answer[data-answer=second-number]").text(e), $(".result__answer[data-answer=date]").text(date), $(".result__answer[data-answer=destiny-number]").text(destiny), matrix.forEach(function(e, t) {
        $(".result__item p[data-index=" + t + "]").text(e || "Пусто")
    })
}

function getLinks() {
    $("input[name=matrix]").val(matrix), $("input[name=dates]").val(date), $("input[name=destiny]").val(destiny)
}

function correct_date( value ) {
    let ppp = value.replace(/[^\d]/g, '');
    let days = ppp.slice(0,2);
    let mm = ppp.slice(2,4);
    let yy = ppp.slice(4);

    if (parseInt(days,10) > 31)
      days='31';
    if ((days.length)&&(days[0] > '3'))
        days = ("000" + parseInt(days,10)).slice(-2);

    if (parseInt(mm,10) > 12)
        mm='12';
    if ((mm.length)&&(mm[0]>'1'))
        mm = ("000" + parseInt(mm,10)).slice(-2);

    let tt = [];
    if (days.length)
      tt.push(days);
    if (mm.length)
        tt.push(mm);
    if (yy.length)
        tt.push(yy);
    ppp = tt.join('.');
    return ppp;
}

function getForm() {
    $(".result__form").show()
}
var price = {},
    res = {},
    social = {},
    date = "",
    dateArray = [],
    secondNumber = [],
    fullNumbers = [],
    matrix = [],
    destiny = 0;
$(document).ready(function() {
	console.log('MatrixStarted');
      $(".matrix_date").mask("00/00/0000"), $(".matrix__button_wrap button").click(function(e) {
        e.preventDefault();
	if ($(".matrix_date").val().length != 10 ) {
		console.log('incorrect value');
		$(".matrix_date").addClass("incorrect");
	}else { 
		$(".matrix_date").removeClass("incorrect");
	 $(".matrix_date").val().length && (getLoader(), clearDate(), replaceDate(), dateArray = clearArray(dateArray), secondNumbers(), fullNumbers = dateArray.concat(secondNumber), fullNumbers = toInteger(), matrix = getMatrix(), destiny = destinyNumber(), showMatrix(), getLinks(), deleteLoader(), getForm());
	}
    })
    $(".matrix_date").on("change paste keyup",(function(e) {
        e.preventDefault();
        var val = $(".matrix_date").val();
	val = correct_date(val);
	$(".matrix_date").val(val);
    })); 

$("#f_bid").mask("00.00.0000");
  

    $('.nav-for-page a').click(function(e) {
        e.preventDefault();
        var _href = $(this).attr("href");
        $("html, body").animate({scrollTop: $(_href).offset().top+"px"});
        return false;
    })
    $('#top').click(function() {
        $('html, body').animate({scrollTop: '0px'});
    });
}), $(".modal__open").click(function(e) {
    var t = $(this).attr("data-theme");
    $(".modal__title").text(t), $(".modal").fadeIn()
}), $(document).mouseup(function(e) {
    var t = ($(".modal"), $(".modal__wrapper"));
    t.is(e.target) || 0 !== t.has(e.target).length || $(".modal").fadeOut()
});
